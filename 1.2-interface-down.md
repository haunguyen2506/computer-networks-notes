# Khi lối đi bị chặn: router phản ứng như thế nào?

Ở bài trước, ta đã thấy rằng:
- Mỗi bảo vệ (router) chỉ biết một phần campus
- Quyết định định tuyến luôn là quyết định cục bộ
- Định tuyến tĩnh và động khác nhau ở cách có được thông tin

Trong bài viết này, chúng ta sẽ giải quyết câu hỏi:
> **Vậy điều gì xảy ra khi một lối đi vốn tồn tại... đột nhiên không còn nữa?**

**Một ngày đẹp trời, lối đi từ B ↔ C bị phong tỏa.**

![Lối đi từ B đến C đã bị chặn](/assets/1.2-downlink.png)

## 1. Không có "thông báo toàn trường"
Khi một lối đi bị chặn:
- Không có cơ chế nào để *mọi bảo vệ biết cùng lúc*
- Chỉ những bảo vệ liên quan trực tiếp phát hiện trước

Với **định tuyến động**, thông tin này sẽ dần được lan truyền
thông qua việc trao đổi giữa các bảo vệ.

Với **định tuyến tĩnh**, điều này không xảy ra:
bảo vệ chỉ biết khi bản đồ được cập nhật thủ công.

Điều này dẫn đến một trạng thái rất quan trọng:
> Trong một khoảng thời gian ngắn, **đặc biệt với định tuyến động**, mỗi bảo vệ có thể đang tin vào một "phiên bản" campus khác nhau.

Trong mạng máy tính, đây là trạng thái **chưa hội tụ**.

## 2. Hành vi của định tuyến tĩnh khi có sự cố
Với định tuyến tĩnh, các quyết định đã được xác định từ trước
Khi lối đi bị chặn:
- bảo vệ vẫn chỉ đường theo thông tin cũ
- học sinh chỉ phát hiện vấn đề khi tới nơi

Điều này không phải do bảo vệ "ra quyết định sai",
mà vì:
> **Định tuyến tĩnh không có cơ chế phản hồi từ môi trường.**
Hệ thống ổn định, nhưng **không tự thích nghi**.

## 3. Hành vi của định tuyến động: thích nghi, nhưng không tức thì
Với định tuyến động, khi lối đi bị chặn:
- Bảo vệ gần nhất phát hiện trước
- Thông tin được truyền dần sang các bảo vệ khác
- Mỗi bảo vệ cập nhật lại "bản đồ trong đầu" của mình

Trong giai đoạn chuyển tiếp này:
- Một số bảo vệ đã cập nhật
- Một số bảo vệ chưa
- Một số bảo vệ chỉ biết một phần thông tin

Kết quả là:
- Hệ thống vẫn hoạt động
- Nhưng đường đi có thể:
    - dài hơn
    - vòng hơn
    - kém **tối ưu hơn** bình thường
Đây là cái giá phải trả cho tính linh hoạt

## 4. Convergence - khi hệ thống "đồng thuận" trở lại
Sau một khoảng thồi gian:
- Thông tin về lối đi bị chặn đã lan đủ rộng
- Tất cả bảo vệ đều thống nhất:
    - lối đó không còn được sử dụng
    - Không còn quyết định nào dựa trên thông tin cũ

Khoảng thời gian từ lúc:
- một bảo vệ phát hiện sự cố

đến khi

- toàn bộ hệ thống có cùng nhận thức

được gọi là **thời gian hội tụ (convergence time)**

Điểm cần lưu ý là:
>**Hệ thống sau hội tụ không quay về trạng thái cũ, mà ổn định ở một cấu hình mới.**

## 5. Từ "đi được" sang "đi tốt"
Sau khi hội tụ:
- Hệ thống thường vẫn còn nhiều lối đi hợp lệ
- Không còn câu hỏi "có đi được hay không"

Thay vào đó là câu hỏi quan trọng hơn:
> **Trong các lối đi còn lại, lối nào nên được ưu tiên?**

Từ đây, định tuyến không còn là bài toán kết nối, mà trở thành bài toán *tối ưu*.

## 6. Điều cần nhớ
- Sự cố không làm mạng sập ngay lập tức
- Mạng có thể hoạt động trong trạng thái "chưa thống nhất"
- Định tuyến động luôn cần thời gian để thích nghi
- Convergence là đặc tính tự nhiên, không phải lỗi

Và điều quan trọng nhất là:
> **Router không chọn đường dựa trên cảm tính, mà dựa trên một tiêu chí đánh giá cụ thể :>**

Tiêu chí đó chính là **metric** - chủ đề của bài tiếp theo.